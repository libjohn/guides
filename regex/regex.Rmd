---
title: "Intro to Regular Expressions (RegEx)"
author: "John Little"
date: "9/14/2016"
output:
  html_document:
    highlight: pygments
    number_sections: no
    theme: readable
    toc: yes
    toc_float: yes
  pdf_document:
    toc: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
A workshop and workbook

* Part of the [Data & Visualization Services](http://library.duke.edu/data) -- [Workshop Series](http://library.duke.edu/data/news) 
* Meet in the /Edge Workshop Room  -- [floor map](http://library.duke.edu/edge/spaces)  
* Wokrshop History
    * September 2016 [Workbook](https://github.com/libjohn/guides/blob/master/regex/regex.Rmd)
    * January 2016 [Workbook](http://v.gd/intro_regex) | [Video](http://library.capture.duke.edu/Panopto/Pages/Viewer.aspx?id=dd4cd7cc-6aa7-4084-a229-615f3aebe6bd)

## Prerequisites
* **Bring YOUR Laptop**

--------

## Outline
* Data & Visualization Services
	* Who We Are
* This workshop is **completely based on the good work from [Intersect](http://www.intersect.org.au/course-resources)** in Australia
	* Presentation:  Slides from the [Intersect Slide Deck](http://www.intersect.org.au/course-resources)
	* Exercises:  Based on slides 15-18
* Hands-on
	* Introduction to RegExr
	* Exercises
* Closing
	* Feedback Form
	* Go forth making expressions and finding patterns with regularity
 
## RegEx -- an Introduction
* [Regular Expressions](https://en.wikipedia.org/wiki/Regular_expression) and RegEx
* [Slides 3-13](/regex/Intersect PDF Materials/Slides.pdf) from [Intersect](http://www.intersect.org.au/course-resources)
* All slides and exercises are the intellectual work of the good folks at Intersect
* Slides and exercises are shared with permission
* Please attribute [Intersect](http://www.intersect.org.au/course-resources)

## Exercise 1 - Find Patterns

### RegExr.com
* Introduction to [RegExr.com](http://regexr.com/) 
* Exercises derived from Intersect Tutorial on Regular Expressions using RegExr

### Whole words
* *Find all literal words*  
* *Simple searches are just like traditional find & replace*

1. [Open the example RFC text in RegExr](http://www.regexr.com/3c7gi)  
    a. In the Expression box, enter `avian` -- 2 matches  <br>![](http://www.clipular.com/c/6697213840326656.png?k=Sr4JJIBaQIQrFV_e22vdal35gLk) ...  ![](http://www.clipular.com/c/5482778819821568.png?k=0ABAsScKdMlMhm02iRyZaI6HTFo)  
    b. Use `Avian` -- 12 matches  
    c. Use `avian` -- with the **ignore case** flag -- 14 matches  <br>![](http://www.clipular.com/c/4523633702600704.png?k=2ANfuhKq9-YlXhHskHO6UWvkeZ0) ...   ![](http://www.clipular.com/c/6101324037881856.png?k=6kHKagztUKV9hfLP2f0z64Euk7E) ...  ![](http://www.clipular.com/c/5227111764721664.png?k=J7C2jn8BBj9xTRXVugf8d9K2ui0)  
    d. Clear the **ignore case** flag  

### Capitalization & character classes
2. **Find only capitalized words**<br>
**Note** *Some characters don't have a literal meaning, these are known as meta characters:  e.g. `"` or `[`*  <br>
*Note* Character classes `[` `]` are denoted by square brackets<br>
*Note* wildcard character is the period: `.`<br>
*Note* multipliers include `*` , `+` , `?`<br>
*Note* Squiggly brackets `{` `}` allow for define repetition<br>
*Note* `\b` is an anchor denoting a word boundary  
     a. `[A-Z]\w*` ![](http://www.clipular.com/c/4898985692102656.png?k=IPiLHHWl3MWUjXTW0gbaLf5j_pY)  
     b. `[A-Z]+` -- match only "all caps" words.  **BUT** this is not quite right.  It doesn't work.  *Do you know why?*  
     c. `\b[A-Z]+\b` -- match on a word boundary using an anchor class:  `\b`  
     d. `\b[A-Z]{2,}\b` -- Abbreviations are usually 2 or more upper case characters.     

### Last word
3. **Match the last words of sentences**<br>
*Note* `\w` is a "word"" character<br>
*Note* `\s` is a "space" character<br>
*Note* `.` is a meta character (intrduced above)  
    a. `\w+.` -- This doesn't work because "." matches every character  
    b. `\w+\.` -- We escape the period "." with a the escape character `\`  
    c. `\w+\.\s` -- More precise this time.  Matching on 56 words.  Using `\s` allows us to stop matching email address by matching   whitespace `\s`  

### Numbers
4. **Find all years**<br>
     *Note: the pipe character `|`* for alternation, alternatives* <br>
     *Note: `(` `)` grouping* <br>
     *Note `{` `}` multiplier*  
    a. `\d\d\d\d` -- a lot of matches here  
    b. `\d{4}` -- more susccinct but has the same meaning as above  
    c. `\b\d{4}\b` -- word boundaries `\b` help but there are still some false positives  
    d. `\b(19|20)\d\d\b` -- better and works for the twenties and twenty-first centuries   

### Phone numbers  
5. Find a phone number<br> 
*Note: escape the parenthesis `\(`*<br>
*Note: `?` indicates optionality matching zero or one occurrence*  
    a. `\(\d{3}\) \d{3}-\d{4}` -- Very specific.  This works as long as phone numbers are formatted consistently  
    b. `\(?\d+\)? ?[\d-]{5,}\d` -- more permissive  
    c. `\(?\d+(\)|.)? ?[\d-.]{5,}\d`	   -- more permissive still.  Allows for `.` instead of - as a separator  

### Email addresses  
6. `\w+@[\w\.]+`<br>
*This rule is quite permissive.  It's likely to match some invalid email addresses. e.g. fred@invalid.net*<br>
*It's also likely to miss valid email addresses like vincent.zappa@intersect.org.au*<br>
**SUGGESTION**: ask the RegExr community:  
    a. left-hand sidebar of RegExr.com  
    b. click *Community*  
    c. search on the term 'email'  
    d. From there, I found this one: <br>   
				`([\w\.]+)@([\w\.]+)\.(\w+)` <br>   
				Wow!  That saved a lot of time and thinking.<br>
				You can rate useful contributions from the community and "privilege" useful contributions.
		  
### Section headings
7. *Note* `+` can be applied to a group<br>
*Note* `^` prior to a match pattern means *begins with*<br>
*Note* `$` following a match patterns means *ends with*  
    a. Using the Flag setting of RegExr (upper-left), set to multiline	-- This enables ^ and $ anchors  
    b. `^(\w+ ?)+$` -- match repeating words + optional space  
    c. Reset the multiline flag   
		
## Exercise 2 - More Patterns

### Get example text

1. [Open Othello text in a browser window](http://shakespeare.mit.edu/othello/full.html) 
2. Copy/Paste full text into [RegExr](http://www.regexr.com/) *Text* panel  

### Alternative spellings & case
3. Turn on the case insensitive flag
4. `honour` -- 14 matches
5. `honou?r` -- optional "u"  and still 14 matches
6. `hon(our|ourable|esty?)` -- honour honourable, honest, honesty; for 66 matches
7. Turn off case insensitive flag -- 61 matches

### Alternative letters and multi-line
8. Turn on multiline matching
9. `^(ACT|SCENE) [IVXLCDM]+` -- literal word, space, roman numerals; for 20 matches
10. Turn off multiline matching  

### Beginning and ending anchors
11. Turn on multiline matching
12. `^[A-Z]+$`
13. Turn off multiline matching

### Punctuation
14. Turn on multiline matching
15. `^.*\?` -- from start of line to question mark
16. Turn off multiline matching  

## Exercise 3 - Replace

### Preparation
1. Generate a small list of random names from the [random name generator](http://listofrandomnames.com/)
2. Click the "List in text area" button, copy and paste the names list to your buffer
3. Replace the text in the RegExr *Text* panel with the random names
4. Click the grey *Substitution* bar at the bottom of RegExr
5. Remove the `\n# $&:\n\t` code in the *Substitution* panel

### Capture Groups
6. `(\w+) (\w+)` -- in the *Expression* panel will highlight all names
7. `"$&"` -- in the *Substitution* pane will reproduce the text pattern matched within forward slashes (*Expression* pane `/`     `/`)
8. `- $2, $1` -- swap the order of the first and last name and precede tha whole name with a dash '-'
9. `<b>$2</b>, $1` -- Bold the last name and add a coma 

## Exercise 4 - Special case

### Preparation
1. Open this [twitter stream data pre-loaded into RegExr](http://www.regexr.com/3cfee)

*Please note this is actual twitter stream data about a politician, the tweets may be offensive*

### Capture #hashtags, @twitter-handles
2. `#\w+` -- #hastag
3. `@\w+` -- @twitter-handle
4. `@[A-Za-z]\w+` -- avoids matching times, e.g. @kairos we're meeting for drinks @10 

---

## Thank You for Attending

* **Please** complete the paper **Feedback Form** 
* **Presenter** 
John Little   
Data Management & Data Analysis Consultant   
Data & Visualization Services   
Duke University Libraries   
* **Other Guides & Workbooks**
	* [DVS Guides Page](http://library.duke.edu/data/guides)
	* Workshop/Workbook Guides by John Little
		* [OpenRefine](http://v.gd/openrefine) -- Easy Data Exploration, Data Transformations, Text Normalization, Data Scraping
		* [Web Scraping](http://v.gd/webscrapting) -- Gathering Data from the Web
		* [Regular Expressions (RegEx)](https://github.com/libjohn/guides/blob/master/regex/regex.Rmd) -- Introduction to pattern matching and pattern manipulation
		
--- 

### Shareable under CC BY-NC-SA license 

Data, presentation, and handouts are shareable under [CC BY-NC-SA license](https://creativecommons.org/licenses/by-nc-sa/4.0/)

![This work is licensed under a Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License.](https://licensebuttons.net/l/by-nc-sa/4.0/88x31.png "This work is licensed under a Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License")
